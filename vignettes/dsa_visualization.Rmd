---
title: "Deterministic Sensitivity Analysis: Visualization"
author: "Fernando Alarid-Escudero, Greg Knowlton, Eva Enns, and the DARTH Team"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Deterministic Sensitivity Analysis: Visualization}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r}
library(dampack)

source("util_models_detfun.R")

state_name <- c("S", "IS", "IA", "T")
cycle <- 100
popsize <- 1000

params_df <- data.frame(pars = c("p_inf", "p_asymp", "p_test_symp", "p_test_asymp", "p_rec"),
                       basecase = c(0.05, 0.8, 0.8, 0.01, 0.01),
                       min = c(0, 0.5, 0.5, 0, 0),
                       max = c(0.5, 0.9, 1, 0.2, 0.5))

params <- c("p_inf", "p_asymp", "p_test_symp", "p_test_asymp", "p_rec")
outcomes <- c("tot_incidence")
```

```{r}
o <- run_owsa_det(params, params_df, nsamps = 10,
                         strategy_func, outcomes,
                         strategies = NULL,
                         state_name = state_name, cycle = cycle)
```

```{r}
plot(o)
```

```{r}
owsa_tornado(o)
```

Can filter out strategies that don't change using `min_rel_diff`.

```{r}
owsa_tornado(o, min_rel_diff = 0.05)
```

```{r}
owsa_tornado(o, return = "data")
```

```{r, fig.height = 6, fig.width = 8}
owsa_opt_strat(o)
```

```{r}
owsa_opt_strat(o, return = "data")
```

```{r}
param1 <- "p_inf"
param2 <- "p_test_asymp"

tw <- run_twsa_det(param1, param2, params_df, nsamps = 30,
                         strategy_func, outcomes,
                         strategies = NULL,
                         state_name = state_name, cycle = cycle)
```

```{r}
plot(tw)
```
